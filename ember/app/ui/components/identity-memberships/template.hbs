<div
  {{did-insert this.onUpdate}}
  {{did-update this.onUpdate @identity}}
>
  <h2>{{t "component.identity-memberships.title"}}</h2>

  {{#if this.fetchInterests.isRunning}}
    <LoadingSpinner />
  {{else}}
    {{#if this.memberships.length}}
      <ul class="uk-list uk-list-divider">
        {{#each this.memberships as |membership|}}
          <li class="uk-flex uk-flex-between uk-flex-middle">
            <div>
              <strong>{{membership.organisation.organisationName}}</strong><br>
              {{membership.role.title}}<br>

              {{#if membership.timeSlot}}
                {{membership.timeSlot}}<br>
              {{/if}}

              {{#if membership.nextElection}}
                {{t "component.identity-memberships.nextElection"
                  date=(moment-format membership.nextElection 'DD.MM.YYYY')
                }}<br>
              {{/if}}

              {{membership.comment}}
            </div>

            <div>
              <button
                class="uk-icon-button uk-button-default"
                type="button"
                disabled={{this.editItem}}
                uk-icon="pencil"
                title={{t "component.identity-memberships.list.edit"}}
                {{on "click" (fn this.edit membership)}}
              ></button>

              <button
                class="uk-icon-button uk-button-default"
                type="button"
                disabled={{or this.editItem this.delete.isRunning}}
                uk-icon="close"
                title={{t "component.identity-memberships.list.delete"}}
                {{on "click" (perform this.delete membership)}}
              ></button>
            </div>
          </li>
        {{/each}}
      </ul>
    {{else}}
      <p>{{t "component.identity-memberships.list.empty"}}</p>
    {{/if}}

    <p class="uk-text-right">
      <button
        class="uk-button uk-button-default"
        type="button"
        disabled={{this.editItem}}
        {{on "click" (fn this.edit null)}}
      >{{t "component.identity-memberships.add"}}</button>
    </p>
  {{/if}}

  {{#if this.editItem}}
    <h3 class="uk-margin-remove-top">
      {{if this.editItem.isNew
        (t "component.identity-memberships.form.title.add")
        (t "component.identity-memberships.form.title.edit")
      }}
    </h3>

    <ValidatedForm
      @model={{changeset this.editItem}}
      @on-submit={{perform this.submit}}
      as |Form|
    >
      <Form.input
        @label={{t "component.identity-memberships.form.label.organisation"}}
        @name="organisation"
        as |field|
      >
        <PowerSelect
          @searchEnabled={{true}}
          @searchField="organisationName"
          @options={{this.identities}}
          @selected={{field.value}}
          @onChange={{field.update}}
          as |opt|
        >
          {{opt.organisationName}}
        </PowerSelect>
      </Form.input>

      <Form.input
        @label={{t "component.identity-memberships.form.label.role"}}
        @name="role"
        as |field|
      >
        <PowerSelect
          @searchEnabled={{true}}
          @searchField="title"
          @options={{this.roles}}
          @selected={{field.value}}
          @onChange={{field.update}}
          as |opt|
        >
          {{opt.title}}
        </PowerSelect>
      </Form.input>

      {{!--
      <div>
        <Form.input
          @label={{t "component.identity-memberships.form.label.timeFrom"}}
          @name="timeSlot.lower"
        />

        <Form.input
          @label={{t "component.identity-memberships.form.label.timeUntil"}}
          @name="timeSlot.upper"
        />
      </div>
      --}}

      <Form.input
        @label={{t "component.identity-memberships.form.label.nextElection"}}
        @name="nextElection"
        as |field|
      >
        <PikadayInput
          class="uk-input"
          @value={{field.value}}
          @onSelection={{field.update}}
        />
      </Form.input>

      <Form.input
        @label={{t "component.identity-memberships.form.label.comment"}}
        @name="comment"
      />

      <p class="uk-text-right">
        <button
          class="uk-button uk-button-default"
          type="button"
          {{on "click" this.cancel}}
        >
          {{t "component.identity-memberships.form.control.cancel"}}
        </button>

        <Form.submit
          @label={{t "component.identity-memberships.form.control.submit"}}
        />
      </p>
    </ValidatedForm>
  {{/if}}
</div>
