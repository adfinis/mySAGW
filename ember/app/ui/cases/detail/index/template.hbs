<div class="uk-grid-collapse" uk-grid>
  <div class="uk-width-1-3">
    <span class="uk-text-large">
      {{t "documents.general"}}
    </span>
  </div>
  <div class="uk-width-2-3">
    <table class="uk-table uk-table-justify uk-table-small">
      <tbody>
        <tr>
          <th class="uk-text-bold uk-width-1-6">
            {{t "documents.number"}}
          </th>
          <td class="uk-width-1-3">
            {{@model.document.answers.edges.firstObject.node.StringAnswerValue}}
          </td>
          <th class="uk-text-bold uk-width-1-6">
            {{t "documents.description"}}
          </th>
          <td class="uk-width-1-3">
            {{or @model.form.description "-"}}
          </td>
        </tr>
        <tr>
          <th class="uk-text-bold uk-width-1-6">
            {{t "documents.createdAt"}}
          </th>
          <td class="uk-width-1-3">
            {{
              if
              @model.createdAt
              (moment-format @model.createdAt "DD.MM.YYYY")
              "-"
            }}
          </td>
          <th class="uk-text-bold uk-width-1-6">
            {{t "documents.modifiedAt"}}
          </th>
          <td class="uk-width-1-3">
            {{
              if
              @model.modifiedAt
              (moment-format @model.modifiedAt "DD.MM.YYYY")
              "-"
            }}
          </td>
        </tr>
        <tr>
          <th>{{t "work-items.title"}}</th>
          <td>{{this.readyWorkItems}}</td>
          <th class="uk-text-bold uk-width-1-6">
            {{t "documents.status"}}
          </th>
          <td class="uk-width-1-3">
            <CaseStateLabel @state={{@model.meta.status}} @iconPosition="right" />
          </td>
        </tr>
      </tbody>
    </table>
  </div>
</div>

<hr />

<div class="uk-grid-collapse" uk-grid>
  <div class="uk-width-1-3">
    <span class="uk-text-large">
      {{t "documents.actions"}}
    </span>
  </div>
  <div class="uk-width-2-3">
    <h3>{{t "documents.accesses.title"}}</h3>
    <table class="uk-table uk-table-divider">
      <thead>
        <tr>
          <th>{{t "documents.accesses.email"}}</th>
          <th></th>
        </tr>
      </thead>
      <tbody>
        {{#each @model.accesses as |access|}}
          <tr>
            <td>{{access.name}}</td>
            <td class="uk-text-right">
              {{#if (and (gt @model.accesses.length 1) (can "delete case" @model access=access))}}
                <button
                  class="uk-icon-button"
                  uk-icon="trash"
                  type="button"
                  title={{t "documents.delete"}}
                  {{on "click" (perform this.deleteRow access)}}
                ></button>
              {{/if}}
            </td>
          </tr>
        {{/each}}
        {{#if (can "add case" @model)}}
          <tr class="uk-text-center">
            <td colspan="2">
              <div uk-toggle="target: #modal-access">
                <UkButton
                  @type="button"
                  @title={{t "documents.accesses.add"}}
                  @on-click={{this.addRow}}
                >
                  <span uk-icon="plus"></span>
                </UkButton>
              </div>
            </td>
          </tr>
        {{/if}}
      </tbody>
    </table>

    {{#if (eq @model.raw.status "RUNNING")}}
      {{#if @model.hasEditableWorkItem}}
        <h3>{{t "documents.edit"}}</h3>
        <p>{{t "documents.editText"}}</p>

        <LinkTo @route="cases.detail.edit" class="uk-button uk-button-default">
          {{t "documents.edit"}}
        </LinkTo>
      {{/if}}

      {{#if @model.hasSubmitWorkItem}}
        <h3>{{t "documents.delete"}}</h3>
        <p>{{t "documents.deleteText"}}</p>

        <UkButton
          @type="button"
          @on-click={{perform this.closeCase @model}}
          @disabled={{this.closeCase.isRunning}}
          @loading={{this.closeCase.isRunning}}
        >
          {{t "documents.delete"}}
        </UkButton>
      {{/if}}

      {{#if (can "exportForAccounting case")}}
        <UkButton
          @type="button"
          @on-click={{perform this.exportAccounting @model}}
          @loading={{this.exportAccounting.isRunning}}
        >
          {{t "documents.accountingExport"}}
        </UkButton>
      {{/if}}
    {{/if}}
  </div>
</div>

<hr />

<div id="modal-access" uk-modal>
  <div class="uk-modal-dialog uk-modal-body">
    <button type="button" class="uk-modal-close-default" uk-close></button>

    <h2 class="uk-modal-title">
      {{t "documents.accesses.addTitle"}}
    </h2>

    <div class="uk-margin">
      <ValidatedForm
        @model={{this.newRow}}
        @on-submit={{perform this.saveRow}}
        as |Form|
      >
        <Form.input
          @label={{t "documents.accesses.email"}}
          @name="email"
        />

        <div class="uk-text-right">
          <UkButton
            {{on "click" (perform this.cancelRow)}}
            class="uk-modal-close"
          >
            {{t "global.cancel"}}
          </UkButton>
          <Form.submit
            @label={{t "global.save"}}
          />
        </div>
      </ValidatedForm>
    </div>
  </div>
</div>
